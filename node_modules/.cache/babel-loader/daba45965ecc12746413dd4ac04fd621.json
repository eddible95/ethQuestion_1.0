{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React, { Component } from 'react';\nimport { Button, Card, Segment, Container, List, Transition, Popup, Modal, Header, Icon, Divider, Form, Input, Message } from \"semantic-ui-react\";\nimport AccountIssueModal from '../components/AccountIssueModal';\nimport web3 from '../ethereum/web3';\nimport Layout from '../components/Layout';\nimport factory from '../ethereum/factory';\nimport credentials from '../ethereum/credentials';\nimport EthQuestionToken from '../ethereum/token';\nimport EthQuestionTokenSale from '../ethereum/tokenSale';\nimport Profile from '../ethereum/profile';\nimport { Router } from '../routes';\nimport { checkLogin, checkRewardField, logging } from '../utils/functions';\nimport cookies from 'next-cookies';\n\nvar userProfile =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(userProfile, _Component);\n\n  function userProfile(props) {\n    var _this;\n\n    _classCallCheck(this, userProfile);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(userProfile).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"toggleVisibility\", function () {\n      return _this.setState(function (prevState) {\n        return {\n          visible: !prevState.visible\n        };\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"topUp\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var account, profileAddress, logTransaction;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.setState({\n                toppingUp: true,\n                errorMessage: ''\n              });\n\n              if (!checkRewardField(_this.state.topUpAmount)) {\n                _context.next = 20;\n                break;\n              }\n\n              _context.prev = 2;\n              account = _this.state.account;\n              _context.next = 6;\n              return factory.methods.getProfile(account).call();\n\n            case 6:\n              profileAddress = _context.sent;\n              logTransaction = logging(\"Top Up: \" + _this.state.topUpAmount + \" EQT(s)\");\n              _context.next = 10;\n              return EthQuestionTokenSale.methods.buyTokens(_this.state.topUpAmount * 1e4, EthQuestionToken._address, profileAddress, logTransaction).send({\n                from: account,\n                value: _this.state.topUpAmount * 1e4 * _this.state.tokenPrice,\n                gasPrice: '0'\n              });\n\n            case 10:\n              Router.pushRoute('/home'); // Automatic redirect the user.\n\n              _context.next = 18;\n              break;\n\n            case 13:\n              _context.prev = 13;\n              _context.t0 = _context[\"catch\"](2);\n\n              _this.setState({\n                errorMessage: _context.t0.message\n              });\n\n              _this.setState({\n                error: true\n              });\n\n              _this.setState({\n                toppingUp: false\n              });\n\n            case 18:\n              _context.next = 23;\n              break;\n\n            case 20:\n              _this.setState({\n                errorMessage: \"Required Field(s) Empty or Invalid Input\"\n              });\n\n              _this.setState({\n                error: true\n              });\n\n              _this.setState({\n                toppingUp: false\n              });\n\n            case 23:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[2, 13]]);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"exchange\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var account, profileAddress, logTransaction;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _this.setState({\n                exchanging: true,\n                errorMessage: ''\n              });\n\n              _context2.prev = 1;\n              account = _this.state.account;\n              _context2.next = 5;\n              return factory.methods.getProfile(account).call();\n\n            case 5:\n              profileAddress = _context2.sent;\n              logTransaction = logging(\"Exchange: 100 Points for 5 EQT(s)\");\n              _context2.next = 9;\n              return web3.eth.personal.unlockAccount(account, \"password\", 600);\n\n            case 9:\n              _context2.next = 11;\n              return EthQuestionTokenSale.methods.exchangeTokens(EthQuestionToken._address, profileAddress, logTransaction).send({\n                from: account,\n                gasPrice: '0'\n              });\n\n            case 11:\n              Router.pushRoute('/home'); // Automatic redirect the user.\n\n              _context2.next = 19;\n              break;\n\n            case 14:\n              _context2.prev = 14;\n              _context2.t0 = _context2[\"catch\"](1);\n\n              _this.setState({\n                errorMessage: _context2.t0.message + \" Insufficient Points\"\n              });\n\n              _this.setState({\n                error: true\n              });\n\n              _this.setState({\n                exchanging: false\n              });\n\n            case 19:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[1, 14]]);\n    })));\n\n    _this.state = {\n      visible: false,\n      login: false,\n      loading: true,\n      accountType: null,\n      account: null,\n      token: null,\n      emailAddress: null,\n      points: null,\n      transactions: [],\n      topUpModalOpen: false,\n      topUp: false,\n      topUpAmount: '',\n      error: false,\n      errorMessage: '',\n      tokenPrice: '',\n      exchanging: false\n    };\n    return _this;\n  }\n\n  _createClass(userProfile, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3() {\n        var login, account, profileAddress, profile, emailAddress, token, etherBalance, points, transactions, tokenPrice, accountType;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(typeof web3 === 'undefined')) {\n                  _context3.next = 3;\n                  break;\n                }\n\n                this.setState({\n                  loading: false\n                });\n                return _context3.abrupt(\"return\");\n\n              case 3:\n                login = false;\n\n                if (!this.props.isLogin) {\n                  _context3.next = 35;\n                  break;\n                }\n\n                login = true; // Get profile data\n\n                account = this.props.account;\n                _context3.next = 9;\n                return factory.methods.getProfile(account).call();\n\n              case 9:\n                profileAddress = _context3.sent;\n                profile = Profile(profileAddress);\n                _context3.next = 13;\n                return credentials.methods.getBinding(account).call();\n\n              case 13:\n                emailAddress = _context3.sent;\n                _context3.next = 16;\n                return EthQuestionToken.methods.balanceOf(account).call();\n\n              case 16:\n                _context3.t0 = _context3.sent;\n                token = (_context3.t0 * 1e-4).toFixed(4);\n                _context3.next = 20;\n                return web3.eth.getBalance(account);\n\n              case 20:\n                etherBalance = _context3.sent;\n                _context3.next = 23;\n                return profile.methods.getPoints().call();\n\n              case 23:\n                points = _context3.sent;\n                _context3.next = 26;\n                return profile.methods.getTransactions().call();\n\n              case 26:\n                transactions = _context3.sent;\n                _context3.next = 29;\n                return EthQuestionTokenSale.methods.getTokenPrice().call();\n\n              case 29:\n                tokenPrice = _context3.sent;\n                _context3.next = 32;\n                return profile.methods.getAccountType().call();\n\n              case 32:\n                accountType = _context3.sent;\n                accountType == 0 ? accountType = \"Admin\" : accountType = \"User\";\n                this.setState({\n                  accountType: accountType,\n                  account: account,\n                  token: token,\n                  etherBalance: etherBalance,\n                  emailAddress: emailAddress,\n                  points: points,\n                  transactions: transactions,\n                  login: true,\n                  tokenPrice: tokenPrice\n                });\n\n              case 35:\n                this.setState({\n                  loading: false\n                });\n\n              case 36:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"renderTransactions\",\n    value: function renderTransactions() {\n      var transactions = this.state.transactions;\n      return transactions.map(function (transaction, index) {\n        return React.createElement(List.Item, {\n          key: index\n        }, React.createElement(List.Icon, {\n          name: \"calendar outline\",\n          size: \"large\",\n          verticalAlign: \"middle\"\n        }), React.createElement(List.Content, null, transaction));\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      if (this.state.login) {\n        return React.createElement(Layout, {\n          accountType: this.state.accountType,\n          page: \"Profile\"\n        }, React.createElement(Divider, {\n          hidden: true\n        }), React.createElement(Container, null, React.createElement(Card, {\n          color: \"red\",\n          centered: true,\n          fluid: true\n        }, React.createElement(Card.Content, null, React.createElement(Header, {\n          as: \"h1\",\n          textAlign: \"center\"\n        }, React.createElement(Icon, {\n          name: \"user\",\n          circular: true\n        })), React.createElement(Card.Header, {\n          textAlign: \"center\"\n        }, \"Account Details:\", React.createElement(\"div\", {\n          style: {\n            color: \"red\",\n            fontSize: \"small\",\n            wordWrap: \"break-word\"\n          }\n        }, this.state.account)), React.createElement(Card.Meta, {\n          textAlign: \"center\"\n        }, React.createElement(\"b\", null, this.state.accountType)), React.createElement(Card.Description, {\n          textAlign: \"center\"\n        }, React.createElement(\"b\", null, \"EQT Balance:\"), \" \", this.state.token, React.createElement(Popup, {\n          trigger: React.createElement(Button, {\n            icon: \"ethereum\",\n            onClick: function onClick() {\n              _this2.setState({\n                topUpModalOpen: true,\n                topUpAmount: '',\n                error: false,\n                errorMessage: ''\n              });\n            },\n            floated: \"right\",\n            size: \"mini\",\n            color: \"green\"\n          }),\n          content: \"Top Up EQT(s)\",\n          inverted: true\n        })), React.createElement(Card.Description, {\n          textAlign: \"center\"\n        }, React.createElement(\"b\", null, \"Ether Balance:\"), \" \", this.state.etherBalance), React.createElement(Card.Description, {\n          textAlign: \"center\"\n        }, React.createElement(\"b\", null, \"Points Accumulated:\"), \" \", this.state.points), React.createElement(Card.Description, {\n          textAlign: \"center\"\n        }, React.createElement(\"b\", null, \"Valid Email Address:\"), \" \", this.state.emailAddress)))), React.createElement(Divider, {\n          hidden: true\n        }), React.createElement(Container, null, React.createElement(Segment, {\n          textAlign: \"center\"\n        }, React.createElement(\"b\", {\n          style: {\n            fontSize: \"20px\"\n          }\n        }, \"Transaction History\"), React.createElement(Popup, {\n          trigger: React.createElement(Button, {\n            icon: this.state.visible ? \"minus\" : \"plus\",\n            onClick: this.toggleVisibility,\n            floated: \"right\",\n            size: \"mini\"\n          }),\n          content: \"Click to expand/close\",\n          inverted: true\n        })), React.createElement(Transition, {\n          visible: this.state.visible,\n          animation: \"scale\",\n          duration: 500\n        }, React.createElement(List, {\n          divided: true,\n          size: \"huge\"\n        }, this.renderTransactions())), React.createElement(Modal, {\n          open: this.state.topUpModalOpen,\n          size: \"small\"\n        }, React.createElement(Header, {\n          icon: \"ethereum\",\n          content: \"Topping Up EQT(s)\"\n        }), React.createElement(Modal.Content, null, React.createElement(Form, {\n          error: !!this.state.errorMessage,\n          style: {\n            marginTop: '10px'\n          }\n        }, React.createElement(Form.Field, {\n          required: true\n        }, React.createElement(\"label\", null, \"Top Up Amount (1 EQT = \", this.state.tokenPrice * 1e-18, \" Ether)\"), React.createElement(Input, {\n          label: \"EQT(s)\",\n          labelPosition: \"right\",\n          placeholder: \"Enter EQT Value\",\n          value: this.state.topUpAmount,\n          onChange: function onChange(event) {\n            return _this2.setState({\n              topUpAmount: event.target.value\n            });\n          }\n        }))), React.createElement(Message, {\n          error: true,\n          header: \"Oops!\",\n          content: this.state.errorMessage,\n          hidden: !this.state.error\n        })), React.createElement(Modal.Actions, null, React.createElement(Button, {\n          color: \"red\",\n          onClick: function onClick() {\n            _this2.setState({\n              topUpModalOpen: false\n            });\n          }\n        }, React.createElement(Icon, {\n          name: \"remove\"\n        }), \" Cancel\"), React.createElement(Button, {\n          color: \"green\",\n          onClick: this.topUp,\n          loading: this.state.toppingUp\n        }, React.createElement(Icon, {\n          name: \"checkmark\"\n        }), \" Top Up\"), React.createElement(Button, {\n          color: \"green\",\n          onClick: this.exchange,\n          loading: this.state.exchanging\n        }, React.createElement(Icon, {\n          name: \"exchange\"\n        }), \" Exchange With Points\")))));\n      } else {\n        return React.createElement(Layout, {\n          accountType: this.state.accountType\n        }, React.createElement(AccountIssueModal, {\n          loading: this.state.loading,\n          login: this.state.login\n        }));\n      }\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(props) {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                return _context4.abrupt(\"return\", {\n                  isLogin: cookies(props).login || '',\n                  account: cookies(props).wallet || ''\n                });\n\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      function getInitialProps(_x) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  return userProfile;\n}(Component);\n\nexport default userProfile;","map":{"version":3,"sources":["C:\\Users\\edd1e\\Desktop\\ethQuestion_1.0\\pages\\userProfile.js"],"names":["React","Component","Button","Card","Segment","Container","List","Transition","Popup","Modal","Header","Icon","Divider","Form","Input","Message","AccountIssueModal","web3","Layout","factory","credentials","EthQuestionToken","EthQuestionTokenSale","Profile","Router","checkLogin","checkRewardField","logging","cookies","userProfile","props","setState","prevState","visible","toppingUp","errorMessage","state","topUpAmount","account","methods","getProfile","call","profileAddress","logTransaction","buyTokens","_address","send","from","value","tokenPrice","gasPrice","pushRoute","message","error","exchanging","eth","personal","unlockAccount","exchangeTokens","login","loading","accountType","token","emailAddress","points","transactions","topUpModalOpen","topUp","isLogin","profile","getBinding","balanceOf","toFixed","getBalance","etherBalance","getPoints","getTransactions","getTokenPrice","getAccountType","map","transaction","index","color","fontSize","wordWrap","toggleVisibility","renderTransactions","marginTop","event","target","exchange","wallet"],"mappings":";;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,MAAT,EAAiBC,IAAjB,EAAuBC,OAAvB,EAAgCC,SAAhC,EAA2CC,IAA3C,EAAiDC,UAAjD,EAA6DC,KAA7D,EAAoEC,KAApE,EACSC,MADT,EACiBC,IADjB,EACuBC,OADvB,EACgCC,IADhC,EACsCC,KADtC,EAC6CC,OAD7C,QAC4D,mBAD5D;AAEA,OAAOC,iBAAP,MAA8B,iCAA9B;AACA,OAAOC,IAAP,MAAiB,kBAAjB;AACA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,OAAOC,OAAP,MAAoB,qBAApB;AACA,OAAOC,WAAP,MAAwB,yBAAxB;AACA,OAAOC,gBAAP,MAA6B,mBAA7B;AACA,OAAOC,oBAAP,MAAiC,uBAAjC;AACA,OAAOC,OAAP,MAAoB,qBAApB;AACA,SAASC,MAAT,QAAuB,WAAvB;AACA,SAASC,UAAT,EAAqBC,gBAArB,EAAuCC,OAAvC,QAAsD,oBAAtD;AACA,OAAOC,OAAP,MAAoB,cAApB;;IAEMC,W;;;;;AACJ,uBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,qFAAMA,KAAN;;AADiB,uEA6DA;AAAA,aACjB,MAAKC,QAAL,CAAc,UAACC,SAAD;AAAA,eAAgB;AAAEC,UAAAA,OAAO,EAAE,CAACD,SAAS,CAACC;AAAtB,SAAhB;AAAA,OAAd,CADiB;AAAA,KA7DA;;AAAA;AAAA;AAAA;AAAA;AAAA,6BAgEX;AAAA;AAAA;AAAA;AAAA;AAAA;AACN,oBAAKF,QAAL,CAAc;AAAEG,gBAAAA,SAAS,EAAE,IAAb;AAAmBC,gBAAAA,YAAY,EAAE;AAAjC,eAAd;;AADM,mBAEHT,gBAAgB,CAAC,MAAKU,KAAL,CAAWC,WAAZ,CAFb;AAAA;AAAA;AAAA;;AAAA;AAIMC,cAAAA,OAJN,GAIgB,MAAKF,KAAL,CAAWE,OAJ3B;AAAA;AAAA,qBAK6BnB,OAAO,CAACoB,OAAR,CAAgBC,UAAhB,CAA2BF,OAA3B,EAAoCG,IAApC,EAL7B;;AAAA;AAKMC,cAAAA,cALN;AAMIC,cAAAA,cANJ,GAMqBhB,OAAO,CAAC,aAAa,MAAKS,KAAL,CAAWC,WAAxB,GAAsC,SAAvC,CAN5B;AAAA;AAAA,qBAOMf,oBAAoB,CAACiB,OAArB,CACLK,SADK,CACK,MAAKR,KAAL,CAAWC,WAAX,GAAuB,GAD5B,EACiChB,gBAAgB,CAACwB,QADlD,EAC4DH,cAD5D,EAC4EC,cAD5E,EAELG,IAFK,CAEA;AACFC,gBAAAA,IAAI,EAAET,OADJ;AAEFU,gBAAAA,KAAK,EAAE,MAAKZ,KAAL,CAAWC,WAAX,GAAuB,GAAvB,GAA6B,MAAKD,KAAL,CAAWa,UAF7C;AAGFC,gBAAAA,QAAQ,EAAE;AAHR,eAFA,CAPN;;AAAA;AAeA1B,cAAAA,MAAM,CAAC2B,SAAP,CAAiB,OAAjB,EAfA,CAe2B;;AAf3B;AAAA;;AAAA;AAAA;AAAA;;AAiBA,oBAAKpB,QAAL,CAAc;AAAEI,gBAAAA,YAAY,EAAE,YAAIiB;AAApB,eAAd;;AACA,oBAAKrB,QAAL,CAAc;AAAEsB,gBAAAA,KAAK,EAAE;AAAT,eAAd;;AACA,oBAAKtB,QAAL,CAAc;AAAEG,gBAAAA,SAAS,EAAE;AAAb,eAAd;;AAnBA;AAAA;AAAA;;AAAA;AAsBJ,oBAAKH,QAAL,CAAc;AAAEI,gBAAAA,YAAY,EAAE;AAAhB,eAAd;;AACA,oBAAKJ,QAAL,CAAc;AAAEsB,gBAAAA,KAAK,EAAE;AAAT,eAAd;;AACA,oBAAKtB,QAAL,CAAc;AAAEG,gBAAAA,SAAS,EAAE;AAAb,eAAd;;AAxBI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAhEW;;AAAA;AAAA;AAAA;AAAA;AAAA,6BA4FR;AAAA;AAAA;AAAA;AAAA;AAAA;AACT,oBAAKH,QAAL,CAAc;AAAEuB,gBAAAA,UAAU,EAAE,IAAd;AAAoBnB,gBAAAA,YAAY,EAAE;AAAlC,eAAd;;AADS;AAGDG,cAAAA,OAHC,GAGS,MAAKF,KAAL,CAAWE,OAHpB;AAAA;AAAA,qBAIsBnB,OAAO,CAACoB,OAAR,CAAgBC,UAAhB,CAA2BF,OAA3B,EAAoCG,IAApC,EAJtB;;AAAA;AAIDC,cAAAA,cAJC;AAKHC,cAAAA,cALG,GAKchB,OAAO,CAAC,mCAAD,CALrB;AAAA;AAAA,qBAMDV,IAAI,CAACsC,GAAL,CAASC,QAAT,CAAkBC,aAAlB,CAAgCnB,OAAhC,EAAyC,UAAzC,EAAqD,GAArD,CANC;;AAAA;AAAA;AAAA,qBAODhB,oBAAoB,CAACiB,OAArB,CACLmB,cADK,CACUrC,gBAAgB,CAACwB,QAD3B,EACqCH,cADrC,EACqDC,cADrD,EAELG,IAFK,CAEA;AACFC,gBAAAA,IAAI,EAAET,OADJ;AAEFY,gBAAAA,QAAQ,EAAE;AAFR,eAFA,CAPC;;AAAA;AAaP1B,cAAAA,MAAM,CAAC2B,SAAP,CAAiB,OAAjB,EAbO,CAaoB;;AAbpB;AAAA;;AAAA;AAAA;AAAA;;AAeP,oBAAKpB,QAAL,CAAc;AAAEI,gBAAAA,YAAY,EAAE,aAAIiB,OAAJ,GAAc;AAA9B,eAAd;;AACA,oBAAKrB,QAAL,CAAc;AAAEsB,gBAAAA,KAAK,EAAE;AAAT,eAAd;;AACA,oBAAKtB,QAAL,CAAc;AAAEuB,gBAAAA,UAAU,EAAE;AAAd,eAAd;;AAjBO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KA5FQ;;AAEjB,UAAKlB,KAAL,GAAa;AACXH,MAAAA,OAAO,EAAE,KADE;AAEX0B,MAAAA,KAAK,EAAE,KAFI;AAGXC,MAAAA,OAAO,EAAE,IAHE;AAIXC,MAAAA,WAAW,EAAE,IAJF;AAKXvB,MAAAA,OAAO,EAAE,IALE;AAMXwB,MAAAA,KAAK,EAAE,IANI;AAOXC,MAAAA,YAAY,EAAE,IAPH;AAQXC,MAAAA,MAAM,EAAE,IARG;AASXC,MAAAA,YAAY,EAAE,EATH;AAUXC,MAAAA,cAAc,EAAE,KAVL;AAWXC,MAAAA,KAAK,EAAE,KAXI;AAYX9B,MAAAA,WAAW,EAAE,EAZF;AAaXgB,MAAAA,KAAK,EAAE,KAbI;AAcXlB,MAAAA,YAAY,EAAE,EAdH;AAeXc,MAAAA,UAAU,EAAE,EAfD;AAgBXK,MAAAA,UAAU,EAAE;AAhBD,KAAb;AAFiB;AAoBlB;;;;;;;;;;;;;sBAOK,OAAOrC,IAAP,KAAgB,W;;;;;AAClB,qBAAKc,QAAL,CAAc;AAAE6B,kBAAAA,OAAO,EAAE;AAAX,iBAAd;;;;AAGED,gBAAAA,K,GAAQ,K;;qBACR,KAAK7B,KAAL,CAAWsC,O;;;;;AACbT,gBAAAA,KAAK,GAAG,IAAR,C,CACA;;AACMrB,gBAAAA,O,GAAU,KAAKR,KAAL,CAAWQ,O;;uBACEnB,OAAO,CAACoB,OAAR,CAAgBC,UAAhB,CAA2BF,OAA3B,EAAoCG,IAApC,E;;;AAAvBC,gBAAAA,c;AACA2B,gBAAAA,O,GAAU9C,OAAO,CAACmB,cAAD,C;;uBACItB,WAAW,CAACmB,OAAZ,CAAoB+B,UAApB,CAA+BhC,OAA/B,EAAwCG,IAAxC,E;;;AAArBsB,gBAAAA,Y;;uBACe1C,gBAAgB,CAACkB,OAAjB,CAAyBgC,SAAzB,CAAmCjC,OAAnC,EAA4CG,IAA5C,E;;;;AAAfqB,gBAAAA,K,mBAAkE,I,EAAMU,O,CAAQ,C;;uBAC3DvD,IAAI,CAACsC,GAAL,CAASkB,UAAT,CAAoBnC,OAApB,C;;;AAArBoC,gBAAAA,Y;;uBACeL,OAAO,CAAC9B,OAAR,CAAgBoC,SAAhB,GAA4BlC,IAA5B,E;;;AAAfuB,gBAAAA,M;;uBACqBK,OAAO,CAAC9B,OAAR,CAAgBqC,eAAhB,GAAkCnC,IAAlC,E;;;AAArBwB,gBAAAA,Y;;uBACmB3C,oBAAoB,CAACiB,OAArB,CAA6BsC,aAA7B,GAA6CpC,IAA7C,E;;;AAAnBQ,gBAAAA,U;;uBAGkBoB,OAAO,CAAC9B,OAAR,CAAgBuC,cAAhB,GAAiCrC,IAAjC,E;;;AAApBoB,gBAAAA,W;AACJA,gBAAAA,WAAW,IAAI,CAAf,GAAmBA,WAAW,GAAG,OAAjC,GAA2CA,WAAW,GAAG,MAAzD;AACA,qBAAK9B,QAAL,CAAc;AAAE8B,kBAAAA,WAAW,EAAEA,WAAf;AACEvB,kBAAAA,OAAO,EAAEA,OADX;AAEEwB,kBAAAA,KAAK,EAAEA,KAFT;AAGEY,kBAAAA,YAAY,EAAEA,YAHhB;AAIEX,kBAAAA,YAAY,EAAEA,YAJhB;AAKEC,kBAAAA,MAAM,EAAEA,MALV;AAMEC,kBAAAA,YAAY,EAAEA,YANhB;AAOEN,kBAAAA,KAAK,EAAE,IAPT;AAQEV,kBAAAA,UAAU,EAAEA;AARd,iBAAd;;;AAUF,qBAAKlB,QAAL,CAAe;AAAE6B,kBAAAA,OAAO,EAAE;AAAX,iBAAf;;;;;;;;;;;;;;;;;;yCAuDmB;AACnB,UAAMK,YAAY,GAAG,KAAK7B,KAAL,CAAW6B,YAAhC;AACA,aAAOA,YAAY,CAACc,GAAb,CAAiB,UAACC,WAAD,EAAcC,KAAd,EAAwB;AAC9C,eACE,oBAAC,IAAD,CAAM,IAAN;AAAW,UAAA,GAAG,EAAEA;AAAhB,WACE,oBAAC,IAAD,CAAM,IAAN;AAAW,UAAA,IAAI,EAAC,kBAAhB;AAAmC,UAAA,IAAI,EAAC,OAAxC;AAAgD,UAAA,aAAa,EAAC;AAA9D,UADF,EAEE,oBAAC,IAAD,CAAM,OAAN,QACGD,WADH,CAFF,CADF;AAQD,OATM,CAAP;AAUD;;;6BAEQ;AAAA;;AACP,UAAI,KAAK5C,KAAL,CAAWuB,KAAf,EAAsB;AACpB,eACE,oBAAC,MAAD;AAAQ,UAAA,WAAW,EAAE,KAAKvB,KAAL,CAAWyB,WAAhC;AAA6C,UAAA,IAAI,EAAE;AAAnD,WACE,oBAAC,OAAD;AAAS,UAAA,MAAM;AAAf,UADF,EAEE,oBAAC,SAAD,QACE,oBAAC,IAAD;AAAM,UAAA,KAAK,EAAG,KAAd;AAAoB,UAAA,QAAQ,MAA5B;AAA6B,UAAA,KAAK;AAAlC,WACE,oBAAC,IAAD,CAAM,OAAN,QACE,oBAAC,MAAD;AAAQ,UAAA,EAAE,EAAC,IAAX;AAAgB,UAAA,SAAS,EAAC;AAA1B,WACE,oBAAC,IAAD;AAAM,UAAA,IAAI,EAAC,MAAX;AAAkB,UAAA,QAAQ;AAA1B,UADF,CADF,EAIE,oBAAC,IAAD,CAAM,MAAN;AAAa,UAAA,SAAS,EAAC;AAAvB,+BAEE;AAAK,UAAA,KAAK,EAAE;AAACqB,YAAAA,KAAK,EAAE,KAAR;AAAeC,YAAAA,QAAQ,EAAE,OAAzB;AAAkCC,YAAAA,QAAQ,EAAE;AAA5C;AAAZ,WAAyE,KAAKhD,KAAL,CAAWE,OAApF,CAFF,CAJF,EAQE,oBAAC,IAAD,CAAM,IAAN;AAAW,UAAA,SAAS,EAAC;AAArB,WACE,+BAAI,KAAKF,KAAL,CAAWyB,WAAf,CADF,CARF,EAWE,oBAAC,IAAD,CAAM,WAAN;AAAkB,UAAA,SAAS,EAAC;AAA5B,WACE,8CADF,OACuB,KAAKzB,KAAL,CAAW0B,KADlC,EAEE,oBAAC,KAAD;AACE,UAAA,OAAO,EACL,oBAAC,MAAD;AACE,YAAA,IAAI,EAAC,UADP;AAEE,YAAA,OAAO,EAAG,mBAAM;AAAC,cAAA,MAAI,CAAC/B,QAAL,CAAc;AAAEmC,gBAAAA,cAAc,EAAE,IAAlB;AAAwB7B,gBAAAA,WAAW,EAAE,EAArC;AAAyCgB,gBAAAA,KAAK,EAAE,KAAhD;AAAuDlB,gBAAAA,YAAY,EAAE;AAArE,eAAd;AAAyF,aAF5G;AAGE,YAAA,OAAO,EAAC,OAHV;AAIE,YAAA,IAAI,EAAC,MAJP;AAKE,YAAA,KAAK,EAAC;AALR,YAFJ;AAUE,UAAA,OAAO,EAAE,eAVX;AAWE,UAAA,QAAQ;AAXV,UAFF,CAXF,EA0BE,oBAAC,IAAD,CAAM,WAAN;AAAkB,UAAA,SAAS,EAAC;AAA5B,WACE,gDADF,OACyB,KAAKC,KAAL,CAAWsC,YADpC,CA1BF,EA6BE,oBAAC,IAAD,CAAM,WAAN;AAAkB,UAAA,SAAS,EAAC;AAA5B,WACE,qDADF,OAC8B,KAAKtC,KAAL,CAAW4B,MADzC,CA7BF,EAgCE,oBAAC,IAAD,CAAM,WAAN;AAAkB,UAAA,SAAS,EAAC;AAA5B,WACE,sDADF,OAC+B,KAAK5B,KAAL,CAAW2B,YAD1C,CAhCF,CADF,CADF,CAFF,EA0CE,oBAAC,OAAD;AAAS,UAAA,MAAM;AAAf,UA1CF,EA2CE,oBAAC,SAAD,QACE,oBAAC,OAAD;AAAS,UAAA,SAAS,EAAC;AAAnB,WACE;AAAG,UAAA,KAAK,EAAE;AAACoB,YAAAA,QAAQ,EAAC;AAAV;AAAV,iCADF,EAEE,oBAAC,KAAD;AACE,UAAA,OAAO,EACL,oBAAC,MAAD;AACE,YAAA,IAAI,EAAE,KAAK/C,KAAL,CAAWH,OAAX,GAAqB,OAArB,GAA+B,MADvC;AAEE,YAAA,OAAO,EAAE,KAAKoD,gBAFhB;AAGE,YAAA,OAAO,EAAC,OAHV;AAIE,YAAA,IAAI,EAAC;AAJP,YAFJ;AASE,UAAA,OAAO,EAAE,uBATX;AAUE,UAAA,QAAQ;AAVV,UAFF,CADF,EAeE,oBAAC,UAAD;AAAY,UAAA,OAAO,EAAE,KAAKjD,KAAL,CAAWH,OAAhC;AAAyC,UAAA,SAAS,EAAC,OAAnD;AAA2D,UAAA,QAAQ,EAAE;AAArE,WACE,oBAAC,IAAD;AAAM,UAAA,OAAO,MAAb;AAAc,UAAA,IAAI,EAAC;AAAnB,WACG,KAAKqD,kBAAL,EADH,CADF,CAfF,EAqBE,oBAAC,KAAD;AAAO,UAAA,IAAI,EAAE,KAAKlD,KAAL,CAAW8B,cAAxB;AAAwC,UAAA,IAAI,EAAC;AAA7C,WACA,oBAAC,MAAD;AAAQ,UAAA,IAAI,EAAC,UAAb;AAAwB,UAAA,OAAO,EAAC;AAAhC,UADA,EAEA,oBAAC,KAAD,CAAO,OAAP,QACE,oBAAC,IAAD;AAAM,UAAA,KAAK,EAAE,CAAC,CAAC,KAAK9B,KAAL,CAAWD,YAA1B;AAAwC,UAAA,KAAK,EAAE;AAAEoD,YAAAA,SAAS,EAAE;AAAb;AAA/C,WACE,oBAAC,IAAD,CAAM,KAAN;AAAY,UAAA,QAAQ,EAAE;AAAtB,WACI,8DAA+B,KAAKnD,KAAL,CAAWa,UAAX,GAAsB,KAArD,YADJ,EAEI,oBAAC,KAAD;AACI,UAAA,KAAK,EAAC,QADV;AAEI,UAAA,aAAa,EAAC,OAFlB;AAGI,UAAA,WAAW,EAAC,iBAHhB;AAII,UAAA,KAAK,EAAE,KAAKb,KAAL,CAAWC,WAJtB;AAKI,UAAA,QAAQ,EAAE,kBAAAmD,KAAK;AAAA,mBAAI,MAAI,CAACzD,QAAL,CAAc;AAAEM,cAAAA,WAAW,EAAEmD,KAAK,CAACC,MAAN,CAAazC;AAA5B,aAAd,CAAJ;AAAA;AALnB,UAFJ,CADF,CADF,EAaE,oBAAC,OAAD;AAAS,UAAA,KAAK,MAAd;AAAe,UAAA,MAAM,EAAC,OAAtB;AAA8B,UAAA,OAAO,EAAE,KAAKZ,KAAL,CAAWD,YAAlD;AAAgE,UAAA,MAAM,EAAE,CAAC,KAAKC,KAAL,CAAWiB;AAApF,UAbF,CAFA,EAiBA,oBAAC,KAAD,CAAO,OAAP,QACE,oBAAC,MAAD;AAAQ,UAAA,KAAK,EAAC,KAAd;AAAoB,UAAA,OAAO,EAAG,mBAAM;AAAC,YAAA,MAAI,CAACtB,QAAL,CAAc;AAAEmC,cAAAA,cAAc,EAAE;AAAlB,aAAd;AAAyC;AAA9E,WACE,oBAAC,IAAD;AAAM,UAAA,IAAI,EAAC;AAAX,UADF,YADF,EAKE,oBAAC,MAAD;AAAQ,UAAA,KAAK,EAAC,OAAd;AAAsB,UAAA,OAAO,EAAE,KAAKC,KAApC;AAA2C,UAAA,OAAO,EAAE,KAAK/B,KAAL,CAAWF;AAA/D,WACE,oBAAC,IAAD;AAAM,UAAA,IAAI,EAAC;AAAX,UADF,YALF,EAQE,oBAAC,MAAD;AAAQ,UAAA,KAAK,EAAC,OAAd;AAAsB,UAAA,OAAO,EAAE,KAAKwD,QAApC;AAA8C,UAAA,OAAO,EAAE,KAAKtD,KAAL,CAAWkB;AAAlE,WACE,oBAAC,IAAD;AAAM,UAAA,IAAI,EAAC;AAAX,UADF,0BARF,CAjBA,CArBF,CA3CF,CADF;AAkGD,OAnGD,MAmGO;AACL,eACE,oBAAC,MAAD;AAAQ,UAAA,WAAW,EAAE,KAAKlB,KAAL,CAAWyB;AAAhC,WACE,oBAAC,iBAAD;AAAmB,UAAA,OAAO,EAAE,KAAKzB,KAAL,CAAWwB,OAAvC;AAAgD,UAAA,KAAK,EAAE,KAAKxB,KAAL,CAAWuB;AAAlE,UADF,CADF;AAKD;AACF;;;;;;iDApN4B7B,K;;;;;kDACpB;AAAEsC,kBAAAA,OAAO,EAAExC,OAAO,CAACE,KAAD,CAAP,CAAe6B,KAAf,IAAwB,EAAnC;AAAwCrB,kBAAAA,OAAO,EAAEV,OAAO,CAACE,KAAD,CAAP,CAAe6D,MAAf,IAAyB;AAA1E,iB;;;;;;;;;;;;;;;;;;;EAxBe1F,S;;AA8O1B,eAAe4B,WAAf","sourcesContent":["import React, { Component } from 'react';\r\nimport { Button, Card, Segment, Container, List, Transition, Popup, Modal,\r\n         Header, Icon, Divider, Form, Input, Message } from \"semantic-ui-react\";\r\nimport AccountIssueModal from '../components/AccountIssueModal';\r\nimport web3 from '../ethereum/web3'\r\nimport Layout from '../components/Layout';\r\nimport factory from '../ethereum/factory';\r\nimport credentials from '../ethereum/credentials';\r\nimport EthQuestionToken from '../ethereum/token';\r\nimport EthQuestionTokenSale from '../ethereum/tokenSale'\r\nimport Profile from '../ethereum/profile';\r\nimport { Router } from '../routes';\r\nimport { checkLogin, checkRewardField, logging } from '../utils/functions'\r\nimport cookies from 'next-cookies';\r\n\r\nclass userProfile extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      visible: false,\r\n      login: false,\r\n      loading: true,\r\n      accountType: null,\r\n      account: null,\r\n      token: null,\r\n      emailAddress: null,\r\n      points: null,\r\n      transactions: [],\r\n      topUpModalOpen: false,\r\n      topUp: false,\r\n      topUpAmount: '',\r\n      error: false,\r\n      errorMessage: '',\r\n      tokenPrice: '',\r\n      exchanging: false\r\n    };\r\n  }\r\n\r\n  static async getInitialProps(props) {\r\n    return { isLogin: cookies(props).login || '' , account: cookies(props).wallet || '' };\r\n  }\r\n\r\n  async componentDidMount() {\r\n    if (typeof web3 === 'undefined') {\r\n      this.setState({ loading: false })\r\n      return\r\n    }\r\n    let login = false;\r\n    if (this.props.isLogin) {\r\n      login = true;\r\n      // Get profile data\r\n      const account = this.props.account;\r\n      const profileAddress = await factory.methods.getProfile(account).call();\r\n      const profile = Profile(profileAddress);\r\n      const emailAddress = await credentials.methods.getBinding(account).call();\r\n      const token = (await EthQuestionToken.methods.balanceOf(account).call()*1e-4).toFixed(4);\r\n      const etherBalance = await web3.eth.getBalance(account);\r\n      const points = await profile.methods.getPoints().call();\r\n      const transactions = await profile.methods.getTransactions().call();\r\n      const tokenPrice = await EthQuestionTokenSale.methods.getTokenPrice().call();\r\n\r\n      // Get Account Type\r\n      let accountType = await profile.methods.getAccountType().call();\r\n      accountType == 0 ? accountType = \"Admin\" : accountType = \"User\"\r\n      this.setState({ accountType: accountType,\r\n                      account: account,\r\n                      token: token,\r\n                      etherBalance: etherBalance,\r\n                      emailAddress: emailAddress,\r\n                      points: points,\r\n                      transactions: transactions,\r\n                      login: true,\r\n                      tokenPrice: tokenPrice });\r\n    }\r\n    this.setState( { loading: false });\r\n  }\r\n\r\n  toggleVisibility = () =>\r\n    this.setState((prevState) => ({ visible: !prevState.visible }))\r\n\r\n  topUp = async () => {\r\n    this.setState({ toppingUp: true, errorMessage: ''});\r\n    if(checkRewardField(this.state.topUpAmount)) {\r\n      try {\r\n          const account = this.state.account;\r\n          const profileAddress = await factory.methods.getProfile(account).call();\r\n          let logTransaction = logging(\"Top Up: \" + this.state.topUpAmount + \" EQT(s)\");\r\n          await EthQuestionTokenSale.methods\r\n          .buyTokens(this.state.topUpAmount*1e4, EthQuestionToken._address, profileAddress, logTransaction)\r\n          .send({\r\n              from: account,\r\n              value: this.state.topUpAmount*1e4 * this.state.tokenPrice,\r\n              gasPrice: '0'\r\n\r\n          });\r\n          Router.pushRoute('/home'); // Automatic redirect the user.\r\n      } catch (err) {\r\n          this.setState({ errorMessage: err.message });\r\n          this.setState({ error: true})\r\n          this.setState({ toppingUp: false });\r\n      }\r\n    } else {\r\n      this.setState({ errorMessage: \"Required Field(s) Empty or Invalid Input\" });\r\n      this.setState({ error: true});\r\n      this.setState({ toppingUp: false });\r\n    }\r\n  }\r\n\r\n  exchange = async () => {\r\n    this.setState({ exchanging: true, errorMessage: ''});\r\n    try {\r\n      const account = this.state.account;\r\n      const profileAddress = await factory.methods.getProfile(account).call();\r\n      let logTransaction = logging(\"Exchange: 100 Points for 5 EQT(s)\");\r\n      await web3.eth.personal.unlockAccount(account, \"password\", 600);\r\n      await EthQuestionTokenSale.methods\r\n      .exchangeTokens(EthQuestionToken._address, profileAddress, logTransaction)\r\n      .send({\r\n          from: account,\r\n          gasPrice: '0'\r\n      });\r\n      Router.pushRoute('/home'); // Automatic redirect the user.\r\n    } catch (err) {\r\n      this.setState({ errorMessage: err.message + \" Insufficient Points\"});\r\n      this.setState({ error: true})\r\n      this.setState({ exchanging: false });\r\n    }\r\n  }\r\n\r\n  renderTransactions() {\r\n    const transactions = this.state.transactions;\r\n    return transactions.map((transaction, index) => {\r\n      return(\r\n        <List.Item key={index}>\r\n          <List.Icon name=\"calendar outline\" size='large' verticalAlign='middle'/>\r\n          <List.Content>\r\n            {transaction}\r\n          </List.Content>\r\n        </List.Item>\r\n      );\r\n    })\r\n  }\r\n\r\n  render() {\r\n    if (this.state.login) {\r\n      return(\r\n        <Layout accountType={this.state.accountType} page={\"Profile\"}>\r\n          <Divider hidden/>\r\n          <Container>\r\n            <Card color = \"red\" centered fluid>\r\n              <Card.Content>\r\n                <Header as='h1' textAlign='center'>\r\n                  <Icon name='user' circular/>\r\n                </Header>\r\n                <Card.Header textAlign='center'>\r\n                  Account Details:\r\n                  <div style={{color: \"red\", fontSize: \"small\", wordWrap: \"break-word\" }}>{this.state.account}</div>\r\n                </Card.Header>\r\n                <Card.Meta textAlign='center'>\r\n                  <b>{this.state.accountType}</b>\r\n                </Card.Meta>\r\n                <Card.Description textAlign='center'>\r\n                  <b>EQT Balance:</b> {this.state.token}\r\n                  <Popup\r\n                    trigger={\r\n                      <Button\r\n                        icon=\"ethereum\"\r\n                        onClick={ () => {this.setState({ topUpModalOpen: true, topUpAmount: '', error: false, errorMessage: '' })} }\r\n                        floated=\"right\"\r\n                        size=\"mini\"\r\n                        color=\"green\"\r\n                      />\r\n                    }\r\n                    content={\"Top Up EQT(s)\"}\r\n                    inverted/>\r\n                </Card.Description>\r\n                <Card.Description textAlign='center'>\r\n                  <b>Ether Balance:</b> {this.state.etherBalance}\r\n                </Card.Description>\r\n                <Card.Description textAlign='center'>\r\n                  <b>Points Accumulated:</b> {this.state.points}\r\n                </Card.Description>\r\n                <Card.Description textAlign='center'>\r\n                  <b>Valid Email Address:</b> {this.state.emailAddress}\r\n                </Card.Description>\r\n              </Card.Content>\r\n            </Card>\r\n          </Container>\r\n          <Divider hidden/>\r\n          <Container>\r\n            <Segment textAlign=\"center\">\r\n              <b style={{fontSize:\"20px\"}}>Transaction History</b>\r\n              <Popup\r\n                trigger={\r\n                  <Button\r\n                    icon={this.state.visible ? \"minus\" : \"plus\"}\r\n                    onClick={this.toggleVisibility}\r\n                    floated=\"right\"\r\n                    size=\"mini\"\r\n                  />\r\n                }\r\n                content={\"Click to expand/close\"}\r\n                inverted/>\r\n            </Segment>\r\n            <Transition visible={this.state.visible} animation='scale' duration={500}>\r\n              <List divided size=\"huge\">\r\n                {this.renderTransactions()}\r\n              </List>\r\n            </Transition>\r\n\r\n            <Modal open={this.state.topUpModalOpen} size='small'>\r\n            <Header icon='ethereum' content='Topping Up EQT(s)' />\r\n            <Modal.Content>\r\n              <Form error={!!this.state.errorMessage} style={{ marginTop: '10px' }}>\r\n                <Form.Field required={true}>\r\n                    <label>Top Up Amount (1 EQT = {this.state.tokenPrice*1e-18} Ether)</label>\r\n                    <Input\r\n                        label=\"EQT(s)\"\r\n                        labelPosition=\"right\"\r\n                        placeholder='Enter EQT Value'\r\n                        value={this.state.topUpAmount}\r\n                        onChange={event => this.setState({ topUpAmount: event.target.value })}\r\n                    />\r\n                </Form.Field>\r\n              </Form>\r\n              <Message error header=\"Oops!\" content={this.state.errorMessage} hidden={!this.state.error}/>\r\n            </Modal.Content>\r\n            <Modal.Actions>\r\n              <Button color='red' onClick={ () => {this.setState({ topUpModalOpen: false })} }>\r\n                <Icon name='remove' /> Cancel\r\n\r\n              </Button>\r\n              <Button color='green' onClick={this.topUp} loading={this.state.toppingUp}>\r\n                <Icon name='checkmark' /> Top Up\r\n              </Button>\r\n              <Button color='green' onClick={this.exchange} loading={this.state.exchanging}>\r\n                <Icon name='exchange' /> Exchange With Points\r\n              </Button>\r\n            </Modal.Actions>\r\n          </Modal>\r\n          </Container>\r\n        </Layout>\r\n      );\r\n    } else {\r\n      return (\r\n        <Layout accountType={this.state.accountType}>\r\n          <AccountIssueModal loading={this.state.loading} login={this.state.login} />\r\n        </Layout>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nexport default userProfile;\r\n"]},"metadata":{},"sourceType":"module"}