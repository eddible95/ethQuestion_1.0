{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { return function () { var Super = _getPrototypeOf(Derived), result; if (_isNativeReflectConstruct()) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport { Button, Form, Container, Divider, Input, Segment, Message, Icon, Modal, Header, Loader } from 'semantic-ui-react';\nimport LoginLayout from '../components/LoginLayout';\nimport web3 from '../ethereum/web3';\nimport Profile from '../ethereum/profile';\nimport factory from '../ethereum/factory';\nimport EthQuestionToken from '../ethereum/token';\nimport EthQuestionTokenSale from '../ethereum/tokenSale';\nimport credentials from '../ethereum/credentials';\nimport { Router } from '../routes';\nimport { validate, logging } from '../utils/functions';\n\nvar passwordHash = require('password-hash');\n\nvar RegisterPage = /*#__PURE__*/function (_Component) {\n  _inherits(RegisterPage, _Component);\n\n  var _super = _createSuper(RegisterPage);\n\n  function RegisterPage() {\n    var _this;\n\n    _classCallCheck(this, RegisterPage);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      emailAddress: '',\n      password: '',\n      loading: false,\n      showKeys: false,\n      errorMessage: ''\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSubmit\", function _callee() {\n      var validEmail, emailNotExist, accounts, hashedPassword, wallet, _hashedPassword, logTransaction;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.setState({\n                loading: true,\n                errorMessage: ''\n              }); // Check for valid NTU Student Email Address, Existence of Email Address and EthWallet\n\n\n              _context.prev = 1;\n              validEmail = validate(_this.state.emailAddress);\n              _context.next = 5;\n              return _regeneratorRuntime.awrap(credentials.methods.emailNotExist(_this.state.emailAddress).call());\n\n            case 5:\n              emailNotExist = _context.sent;\n\n              if (!(validEmail && !emailNotExist)) {\n                _context.next = 36;\n                break;\n              }\n\n              if (!(_this.state.emailAddress === \"admin\")) {\n                _context.next = 17;\n                break;\n              }\n\n              _context.next = 10;\n              return _regeneratorRuntime.awrap(web3.eth.getAccounts());\n\n            case 10:\n              accounts = _context.sent;\n              hashedPassword = passwordHash.generate(_this.state.password);\n              _context.next = 14;\n              return _regeneratorRuntime.awrap(factory.methods // Create Admin\n              .createAdmin(credentials._address, _this.state.emailAddress, hashedPassword).send({\n                from: accounts[0],\n                gasPrice: \"0\"\n              }));\n\n            case 14:\n              document.cookie = \"wallet=\".concat(accounts[0], \"; path=/\");\n              _context.next = 32;\n              break;\n\n            case 17:\n              _context.next = 19;\n              return _regeneratorRuntime.awrap(web3.eth.accounts.create());\n\n            case 19:\n              wallet = _context.sent;\n              _hashedPassword = passwordHash.generate(_this.state.password);\n              _context.next = 23;\n              return _regeneratorRuntime.awrap(web3.eth.personal.importRawKey(wallet['privateKey'].slice(2), _this.state.password));\n\n            case 23:\n              _context.next = 25;\n              return _regeneratorRuntime.awrap(web3.eth.personal.unlockAccount(wallet['address'], _this.state.password, 3600));\n\n            case 25:\n              logTransaction = logging(\"Credited 10 EQT(s) for first time User\");\n              _context.next = 28;\n              return _regeneratorRuntime.awrap(EthQuestionTokenSale.methods);\n\n            case 28:\n              _context.next = 30;\n              return _regeneratorRuntime.awrap(factory.methods.createProfile(credentials._address, _this.state.emailAddress, _hashedPassword, EthQuestionToken._address, EthQuestionTokenSale._address, logTransaction).send({\n                from: wallet['address'],\n                gasPrice: \"0\"\n              }));\n\n            case 30:\n              document.cookie = \"wallet=\".concat(wallet['address'], \"; path=/\");\n\n              _this.setState({\n                publicKey: wallet['address'],\n                privateKey: wallet['privateKey']\n              });\n\n            case 32:\n              document.cookie = \"login=\".concat(true, \"; path=/\");\n\n              _this.setState({\n                loading: false,\n                showKeys: true\n              });\n\n              _context.next = 38;\n              break;\n\n            case 36:\n              _this.setState({\n                errorMessage: \"Invalid Email Address or Email Address Already In Used\"\n              });\n\n              _this.setState({\n                loading: false\n              });\n\n            case 38:\n              _context.next = 44;\n              break;\n\n            case 40:\n              _context.prev = 40;\n              _context.t0 = _context[\"catch\"](1);\n\n              _this.setState({\n                errorMessage: _context.t0.message\n              });\n\n              _this.setState({\n                loading: false\n              });\n\n            case 44:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[1, 40]], Promise);\n    });\n\n    return _this;\n  }\n\n  _createClass(RegisterPage, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      return _regeneratorRuntime.async(function componentDidMount$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              // Delete any existing Cookies\n              document.cookie = \"login=\".concat(false, \"; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT\");\n              document.cookie = \"wallet=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT\";\n\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }\n  }, {\n    key: \"renderForm\",\n    value: function renderForm() {\n      var _this2 = this;\n\n      return __jsx(Form, {\n        error: !!this.state.errorMessage\n      }, __jsx(Segment, {\n        raised: true,\n        textAlign: \"center\"\n      }, \"This will create a password-protected account using your NTU email address and have it linked to cryptocurrency wallet created by the system.\"), __jsx(Form.Field, null, __jsx(\"label\", null, \"NTU Student Email Address\"), __jsx(Input, {\n        placeholder: \"example@e.ntu.edu.sg\",\n        value: this.state.emailAddress,\n        onChange: function onChange(event) {\n          return _this2.setState({\n            emailAddress: event.target.value\n          });\n        }\n      })), __jsx(Form.Field, null, __jsx(\"label\", null, \"Password\"), __jsx(Input, {\n        placeholder: \"Password\",\n        type: \"password\",\n        value: this.state.password,\n        onChange: function onChange(event) {\n          return _this2.setState({\n            password: event.target.value\n          });\n        }\n      })), __jsx(Message, {\n        error: true,\n        header: \"Oops!\",\n        content: this.state.errorMessage\n      }), __jsx(Modal, {\n        open: this.state.loading,\n        trigger: __jsx(Button, {\n          primary: true,\n          onClick: this.onSubmit\n        }, \"Register\"),\n        basic: true,\n        size: \"small\"\n      }, __jsx(Header, {\n        content: \"Registering Your Email Address\"\n      }), __jsx(Modal.Content, null, __jsx(\"p\", null, \"Creating of password-protected account. Please wait...\"), __jsx(Loader, {\n        active: true,\n        inline: \"centered\"\n      }, \"Registering Your Email\"))), __jsx(Modal, {\n        open: this.state.showKeys,\n        basic: true,\n        size: \"small\"\n      }, __jsx(Header, {\n        content: \"Wallet Information\"\n      }), __jsx(Modal.Content, null, \"WARNING: Never reveal your private key to anyone. These keys will be required for future access to your wallet, please have it recorded down.\", __jsx(\"p\", null, \"Public Key: \", this.state.publicKey), __jsx(\"p\", null, \"Private Key: \", this.state.privateKey)), __jsx(Modal.Actions, null, __jsx(Button, {\n        color: \"green\",\n        onClick: function onClick() {\n          return Router.pushRoute(\"/home\");\n        }\n      }, __jsx(Icon, {\n        name: \"checkmark\"\n      }), \" Okay\"))), __jsx(Button, {\n        primary: true,\n        onClick: function onClick() {\n          return Router.pushRoute(\"/\");\n        }\n      }, \"Go Back\"));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return __jsx(LoginLayout, null, __jsx(Container, {\n        style: {\n          height: \"100vh\"\n        }\n      }, this.renderForm()));\n    }\n  }]);\n\n  return RegisterPage;\n}(Component);\n\nexport default RegisterPage;","map":{"version":3,"sources":["C:/Users/edd1e/Desktop/ethQuestion_1.0/pages/register.js"],"names":["React","Component","Button","Form","Container","Divider","Input","Segment","Message","Icon","Modal","Header","Loader","LoginLayout","web3","Profile","factory","EthQuestionToken","EthQuestionTokenSale","credentials","Router","validate","logging","passwordHash","require","RegisterPage","emailAddress","password","loading","showKeys","errorMessage","setState","validEmail","state","methods","emailNotExist","call","eth","getAccounts","accounts","hashedPassword","generate","createAdmin","_address","send","from","gasPrice","document","cookie","create","wallet","personal","importRawKey","slice","unlockAccount","logTransaction","createProfile","publicKey","privateKey","message","event","target","value","onSubmit","pushRoute","height","renderForm"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Button, Form, Container, Divider, Input,\r\n   Segment, Message, Icon, Modal, Header, Loader } from 'semantic-ui-react'\r\nimport LoginLayout from '../components/LoginLayout';\r\nimport web3 from '../ethereum/web3';\r\nimport Profile from '../ethereum/profile';\r\nimport factory from '../ethereum/factory';\r\nimport EthQuestionToken from '../ethereum/token';\r\nimport EthQuestionTokenSale from '../ethereum/tokenSale';\r\nimport credentials from '../ethereum/credentials';\r\nimport { Router } from '../routes';\r\nimport { validate, logging } from '../utils/functions';\r\nvar passwordHash = require('password-hash');\r\n\r\nclass RegisterPage extends Component {\r\n\r\n  state = {\r\n    emailAddress:'',\r\n    password:'',\r\n    loading: false,\r\n    showKeys: false,\r\n    errorMessage:''\r\n  };\r\n\r\n  async componentDidMount() {\r\n    // Delete any existing Cookies\r\n    document.cookie = `login=${false}; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT`;\r\n    document.cookie = `wallet=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT`;\r\n  };\r\n\r\n  onSubmit = async () => {\r\n    this.setState({ loading: true, errorMessage: '' });\r\n    // Check for valid NTU Student Email Address, Existence of Email Address and EthWallet\r\n    try {\r\n      let validEmail = validate(this.state.emailAddress);\r\n      let emailNotExist = await credentials.methods.emailNotExist(this.state.emailAddress).call();\r\n      if (validEmail && !emailNotExist) {\r\n        if(this.state.emailAddress === \"admin\") {\r\n          const accounts = await web3.eth.getAccounts();\r\n          let hashedPassword = passwordHash.generate(this.state.password);\r\n          await factory.methods\r\n          // Create Admin\r\n          .createAdmin(credentials._address, this.state.emailAddress, hashedPassword)\r\n          .send({\r\n              from: accounts[0],\r\n              gasPrice: \"0\"\r\n          });\r\n          document.cookie = `wallet=${accounts[0]}; path=/`;\r\n        } else {\r\n          // Create a new Profile\r\n          let wallet = await web3.eth.accounts.create();\r\n          let hashedPassword = passwordHash.generate(this.state.password);\r\n          await web3.eth.personal.importRawKey(wallet['privateKey'].slice(2), this.state.password);\r\n          await web3.eth.personal.unlockAccount(wallet['address'], this.state.password, 3600);\r\n          let logTransaction = logging(\"Credited 10 EQT(s) for first time User\");\r\n          await EthQuestionTokenSale.methods\r\n          await factory.methods\r\n          .createProfile(credentials._address, this.state.emailAddress, hashedPassword,\r\n            EthQuestionToken._address, EthQuestionTokenSale._address, logTransaction)\r\n          .send({\r\n              from: wallet['address'],\r\n              gasPrice: \"0\"\r\n          });\r\n          document.cookie = `wallet=${wallet['address']}; path=/`;\r\n          this.setState({ publicKey: wallet['address'], privateKey: wallet['privateKey'] })\r\n        }\r\n        document.cookie = `login=${true}; path=/`;\r\n        this.setState({ loading: false, showKeys: true });\r\n      } else {\r\n        this.setState({ errorMessage: \"Invalid Email Address or Email Address Already In Used\" });\r\n        this.setState({ loading: false });\r\n      }\r\n    } catch (err) {\r\n      this.setState({ errorMessage: err.message });\r\n      this.setState({ loading: false });\r\n    }\r\n  }\r\n\r\n  renderForm() {\r\n    return(\r\n      <Form error={!!this.state.errorMessage}>\r\n        <Segment raised textAlign={\"center\"}>\r\n          This will create a password-protected account using your NTU email address and have it linked to cryptocurrency wallet created\r\n          by the system.\r\n        </Segment>\r\n        <Form.Field>\r\n          <label>NTU Student Email Address</label>\r\n          <Input\r\n              placeholder='example@e.ntu.edu.sg'\r\n              value={this.state.emailAddress}\r\n              onChange={event => this.setState({ emailAddress: event.target.value})}\r\n          />\r\n        </Form.Field>\r\n        <Form.Field>\r\n          <label>Password</label>\r\n          <Input\r\n              placeholder='Password'\r\n              type='password'\r\n              value={this.state.password}\r\n              onChange={event => this.setState({ password: event.target.value})}\r\n          />\r\n        </Form.Field>\r\n        <Message error header=\"Oops!\" content={this.state.errorMessage} />\r\n        <Modal open={this.state.loading} trigger={<Button primary onClick={this.onSubmit}>Register</Button>} basic size='small'>\r\n          <Header content='Registering Your Email Address' />\r\n          <Modal.Content>\r\n            <p>\r\n              Creating of password-protected account. Please wait...\r\n            </p>\r\n            <Loader active inline=\"centered\">\r\n              Registering Your Email\r\n            </Loader>\r\n          </Modal.Content>\r\n        </Modal>\r\n        <Modal open={this.state.showKeys} basic size='small'>\r\n          <Header content='Wallet Information' />\r\n          <Modal.Content>\r\n            WARNING: Never reveal your private key to anyone. These keys will be required for future access to\r\n            your wallet, please have it recorded down.\r\n            <p>Public Key: {this.state.publicKey}</p>\r\n            <p>Private Key: {this.state.privateKey}</p>\r\n          </Modal.Content>\r\n          <Modal.Actions>\r\n            <Button color='green' onClick={ () => Router.pushRoute(`/home`) }>\r\n              <Icon name='checkmark' /> Okay\r\n            </Button>\r\n          </Modal.Actions>\r\n        </Modal>\r\n        <Button primary onClick={() => Router.pushRoute(`/`)}>Go Back</Button>\r\n      </Form>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    return(\r\n      <LoginLayout>\r\n          <Container style={{height:\"100vh\"}}>\r\n              {this.renderForm()}\r\n          </Container>\r\n      </LoginLayout>\r\n    );\r\n  }\r\n}\r\n\r\nexport default RegisterPage;\r\n"]},"metadata":{},"sourceType":"module"}